<!DOCTYPE html>
<html>

<head>
<link rel="stylesheet" href="style.css">
<title>Carlos Home Page</title>
<script language=javascript type="text/javascript">
var ajax_request;
var count = 0;
function new_request() {
	document.getElementById('test_dispcmd').innerHTML = document.getElementById('user_command').value;
	ajax_request = null;
	if (window.XMLHttpRequest) {
		ajax_request = new XMLHttpRequest();
	} else if (window.ActiveXObject) {
		ajax_request = new ActiveXObject("Microsoft.XMLHTTP");
	}
	if (ajax_request != null) {
		ajax_request.onreadystatechange = display_result;
		var url = "/driveloop.php";
		var payload = "cmd=PAYLOAD";
		ajax_request.open("POST", url, true);
		ajax_request.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
		ajax_request.send(payload);
		log("Sent AJAX request to run command " + " PAYLOAD");
		count = count + 1;
		document.getElementById('counter').innerHTML = count;
	} else {
		alert("Rats! Looks like your browser doesn't support XMLHTTP.");
	}
}

function display_result() {
	document.getElementById('put_state').innerHTML = ajax_request.readyState;
	if(ajax_request.readyState == 4) { 	// 4 => page loaded
	  if(ajax_request.status == 200)  {	// 200 => OK
		log("Received response from driveloop.php");
		document.getElementById('terminal').innerHTML = ajax_request.responseText;
	  } else {
		log("Unable to load response to your AJAX request");
		alert("Unable to load response to your AJAX request.");
	  }
	}	
}

var session_request;
function init_session() {
	session_request = null;
        if (window.XMLHttpRequest) {
                session_request = new XMLHttpRequest();
		log("Your browser uses XMLHttpRequest");
        } else if (window.ActiveXObject) {
                session_request = new ActiveXObject("Microsoft.XMLHTTP");
		log("Your browser uses ActiveXObject");
        }
        if (session_request != null) {
                session_request.onreadystatechange = init_session_callback;
                var url = "/init_session.php";
                session_request.open("POST", url, true);
                session_request.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
                session_request.send(null);
		log("Sent AJAX request for server shell session");
        } else {
                alert("Rats! Looks like your browser doesn't support XMLHTTP.");
        }
}

function init_session_callback() {
	if (session_request.readyState == 4) {
	   if(session_request.status == 200) {
		log("Response: initialized shell session...");
	   } else {
		log("Unable to load response to your AJAX request");
		alert("Unable to load response to your AJAX request (init session request).");
	   }
	}
}
	
function log(text) {
	var log_obj = document.getElementById('log');
	log_obj.insertAdjacentHTML('beforeend', text + "<br>");
	log_obj.scrollTop = log_obj.scrollHeight;
}
</script>
</head>

<body onload="init_session()" style="background-color:rgb(200,200,200);">
<div id="welcome">
	<h1 id="test_dispcmd" style="text-align:center;">WELCOME!</h1>
</div>

<div style="height:160px;border-bottom:1px green solid;">
	<p id="put_state" style="color:blue;text-align:center;">
		This page is under construction. <br>Please check back in soon!
	</p>
	<input id="user_command" type="text" name="command">
	<button onclick="new_request()">Request</button>
	<p id="counter">0</p>
</div>

<div id="bottom">
	<div id="pages">About</div>
	<div id="middle_content">Middle</div>
	<div id="right_content">
		<div class="console_frame">
			<p style="text-align:center;">TERMINAL</p>
			<div id="terminal" class="console"></div>
		</div>
		<div class="console_frame">
			<p style="text-align:center;">LOG</p>
			<div id="log" class="console"></div>
		</div>
	</div>
</div>
</body>

</html>

